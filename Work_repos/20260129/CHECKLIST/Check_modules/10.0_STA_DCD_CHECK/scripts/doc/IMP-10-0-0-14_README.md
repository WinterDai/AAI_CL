# IMP-10-0-0-14: Confirm the noise/glitch check result is clean.

## Overview

**Check ID:** IMP-10-0-0-14  
**Description:** Confirm the noise/glitch check result is clean.  
**Category:** Noise/Glitch Analysis Verification  
**Input Files:** 
- `${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt`
- `${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt`

This checker validates noise/glitch analysis reports from Cadence Tempus/Innovus to ensure the design has no DC tolerance violations or receiver output peak violations. It parses multiple noise report files (one per timing view/corner), extracts violation counts, and aggregates results across all views. The check passes only when all views show zero violations (clean status).

---

## Check Logic

### Input Parsing

The checker parses noise analysis reports generated by Cadence Tempus/Innovus. Each report contains:
1. **Header metadata**: Design name, view name, timestamp, command
2. **Report options**: Threshold configuration table (VL/VH values for Clock/Data/Latch)
3. **Glitch Violations Summary**: Violation counts (DC tolerance, receiver output peak, total problem nets)
4. **Detailed violation table** (only present if violations > 0): Net names, violation types, noise values, affected pins

**Key Patterns:**

```python
# Pattern 1: Extract design name from header
pattern1 = r'^#\s+Design:\s+(\S+)'
# Example: "#  Design:            cdn_sd2101_i3p765_vm130_6x2ya2yb2yc2yd1ye1ga1gb"

# Pattern 2: Extract view name from header
pattern2 = r'^#\s+View:\s+(.+)$'
# Example: "#  View:              func_rcff_0p825v_125c_pcff_cmin_pcff3_hold"

# Pattern 3: Extract DC tolerance violations count
pattern3 = r'^Number of DC tolerance violations \(VH \+ VL\)\s*=\s*(\d+)'
# Example: "Number of DC tolerance violations (VH + VL) = 0"

# Pattern 4: Extract receiver output peak violations count
pattern4 = r'^Number of Receiver Output Peak violations \(VH \+ VL\)\s*=\s*(\d+)'
# Example: "Number of Receiver Output Peak violations (VH + VL) = 0"

# Pattern 5: Extract total problem noise nets count (primary pass/fail indicator)
pattern5 = r'^Number of total problem noise nets\s*=\s*(\d+)'
# Example: "Number of total problem noise nets = 0"
```

### Detection Logic

1. **File Validation**: Check that all input noise report files exist and are non-empty
2. **Per-File Parsing**:
   - Extract design name and view name from header section
   - Parse "Glitch Violations Summary" section to extract violation counts:
     - DC tolerance violations (VH + VL)
     - Receiver output peak violations (VH + VL)
     - Total problem noise nets (primary metric)
   - If total_problem_nets > 0, parse detailed violation table (net names, types, noise values)
3. **Aggregation**: Combine results from all files (views/corners)
4. **Pass/Fail Determination**:
   - **PASS**: All views have total_problem_nets = 0 (clean)
   - **FAIL**: Any view has total_problem_nets > 0 (violations detected)
5. **Output Generation**:
   - **INFO01**: For clean views, display view name and confirmation of zero violations
   - **ERROR01**: For views with violations, display view name, violation counts, and detailed violation information

---

## Output Descriptions (CRITICAL - Code Generator Uses These!)

This section defines the output strings used by `build_complete_output()` in the checker code.
**Fill in these values based on the check logic above.**

```python
# Item description for this checker
item_desc = "Confirm the noise/glitch check result is clean."

# PASS case - what message to show when check passes
found_reason = "All noise/glitch analysis views are clean (0 violations)"
found_desc = "Noise/glitch analysis verification passed"

# FAIL case - what message to show when check fails
missing_reason = "Noise/glitch violations detected in one or more views"
missing_desc = "Noise/glitch analysis verification failed"

# WAIVED case (Type 3/4) - what message to show for waived items
waived_base_reason = "Noise/glitch violations waived per design team approval"
waived_desc = "Waived noise/glitch violations"

# UNUSED waivers - what message to show for unused waiver entries
unused_waiver_reason = "Waiver not matched - no corresponding violation found in noise reports"
unused_desc = "Unused waiver entries"
```

### INFO01/ERROR01 Display Format

```
INFO01 (Clean/Pass items):
  Format: "View: {view_name} - CLEAN (DC violations: {dc_count}, Peak violations: {peak_count}, Total problem nets: {total_count})"
  Example: "View: func_rcff_0p825v_125c_pcff_cmin_pcff3_hold - CLEAN (DC violations: 0, Peak violations: 0, Total problem nets: 0)"

ERROR01 (Violation/Fail items):
  Format: "View: {view_name} - VIOLATIONS DETECTED (DC violations: {dc_count}, Peak violations: {peak_count}, Total problem nets: {total_count})"
  Example: "View: func_rcss_0p675v_125c_pcss_cmax_prcs3_setup - VIOLATIONS DETECTED (DC violations: 5, Peak violations: 3, Total problem nets: 8)"
```

---

## Type 1: Boolean Check

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-14:
  description: "Confirm the noise/glitch check result is clean."
  requirements:
    value: N/A
    pattern_items: []
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt"
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt"
  waivers:
    value: N/A
    waive_items: []
```

**Check Behavior:**
Type 1 performs custom boolean checks (file exists? config valid?).
PASS/FAIL based on checker's own validation logic.

**Sample Output (PASS):**
```
Status: PASS
Reason: All noise/glitch analysis views are clean (0 violations)
INFO01:
  - View: func_rcff_0p825v_125c_pcff_cmin_pcff3_hold - CLEAN (DC violations: 0, Peak violations: 0, Total problem nets: 0)
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_hold - CLEAN (DC violations: 0, Peak violations: 0, Total problem nets: 0)
```

**Sample Output (FAIL):**
```
Status: FAIL
Reason: Noise/glitch violations detected in one or more views
ERROR01:
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_setup - VIOLATIONS DETECTED (DC violations: 5, Peak violations: 3, Total problem nets: 8)
```

### Type 1 Variant: waivers.value=0 (Forced PASS Mode)

**Configuration:**
```yaml
IMP-10-0-0-14:
  description: "Confirm the noise/glitch check result is clean."
  requirements:
    value: N/A
    pattern_items: []
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt"
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt"
  waivers:
    value: 0  # CRITICAL: value=0 triggers forced PASS mode (NOT waiver logic!)
    waive_items:  # IMPORTANT: Use PLAIN STRING format (NOT name/reason dict!)
      - "Explanation: Noise/glitch violations are informational only for this design revision"
      - "Note: Violations are expected in low-power modes and do not affect functional operation"
      - "Approved by: Design team lead on 2024-01-15"
```

**CRITICAL Behavior (waivers.value=0):**
- NOTE: Type 1 has NO waiver logic. waive=0 is forced PASS mode only
- IMPORTANT: waive_items uses PLAIN STRINGS (NOT name/reason dict like Type 3/4!)
- waive_items serves as COMMENT ONLY (no matching/filtering logic)
- waive_items content printed as INFO with [WAIVED_INFO] tag
- ALL violations force converted: FAIL→PASS, displayed as INFO with [WAIVED_AS_INFO] tag
- Check ALWAYS returns PASS (violations shown as INFO for tracking)
- Used when: Check is informational only, violations expected/acceptable

**Sample Output (PASS with violations):**
```
Status: PASS  # Always PASS when waivers.value=0
Reason: All violations waived as informational
INFO01 ([WAIVED_INFO] - waive_items as comment):
  - "Explanation: Noise/glitch violations are informational only for this design revision"
  - "Note: Violations are expected in low-power modes and do not affect functional operation"
  - "Approved by: Design team lead on 2024-01-15"
INFO02 ([WAIVED_AS_INFO] - violations converted to PASS, shown as INFO):
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_setup - VIOLATIONS DETECTED (DC violations: 5, Peak violations: 3, Total problem nets: 8) [WAIVED_AS_INFO]
```

---

## Type 2: Value Check

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-14:
  description: "Confirm the noise/glitch check result is clean."
  requirements:
    value: 2
    pattern_items:
      - "func_rcff_0p825v_125c_pcff_cmin_pcff3_hold"
      - "func_rcss_0p675v_125c_pcss_cmax_prcs3_hold"
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt"
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt"
  waivers:
    value: N/A
    waive_items: []
```

**Check Behavior:**
Type 2 searches pattern_items in input files.
PASS/FAIL depends on check purpose:
- Violation Check: PASS if found_items empty (no violations)
- Requirement Check: PASS if missing_items empty (all requirements met)

**Sample Output (PASS):**
```
Status: PASS
Reason: All noise/glitch analysis views are clean (0 violations)
INFO01:
  - View: func_rcff_0p825v_125c_pcff_cmin_pcff3_hold - CLEAN (DC violations: 0, Peak violations: 0, Total problem nets: 0)
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_hold - CLEAN (DC violations: 0, Peak violations: 0, Total problem nets: 0)
```

### Type 2 Variant: waivers.value=0 (Forced PASS Mode)

**Configuration:**
```yaml
IMP-10-0-0-14:
  description: "Confirm the noise/glitch check result is clean."
  requirements:
    value: 2
    pattern_items:
      - "func_rcff_0p825v_125c_pcff_cmin_pcff3_hold"
      - "func_rcss_0p675v_125c_pcss_cmax_prcs3_hold"
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt"
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt"
  waivers:
    value: 0  # CRITICAL: value=0 triggers forced PASS mode (NOT waiver logic!)
    waive_items:  # IMPORTANT: Use PLAIN STRING format (NOT name/reason dict!)
      - "Explanation: Noise/glitch check is informational only for this milestone"
      - "Note: Pattern mismatches are expected during early design phases"
      - "Action: Will be enforced in final signoff"
```

**CRITICAL Behavior (waivers.value=0):**
- NOTE: Type 2 has NO waiver logic. waive=0 is forced PASS mode only
- IMPORTANT: waive_items uses PLAIN STRINGS (NOT name/reason dict like Type 3/4!)
- waive_items serves as COMMENT ONLY (no matching/filtering logic)
- waive_items content printed as INFO with [WAIVED_INFO] tag
- ALL errors/mismatches force converted: ERROR→PASS, displayed as INFO with [WAIVED_AS_INFO] tag
- Check ALWAYS returns PASS (errors shown as INFO for tracking)
- Used when: Pattern check is informational, mismatches expected

**Sample Output (PASS with mismatches):**
```
Status: PASS  # Always PASS when waivers.value=0
Reason: All mismatches waived as informational
INFO01 ([WAIVED_INFO] - waive_items as comment):
  - "Explanation: Noise/glitch check is informational only for this milestone"
  - "Note: Pattern mismatches are expected during early design phases"
  - "Action: Will be enforced in final signoff"
INFO02 ([WAIVED_AS_INFO] - errors converted to PASS, shown as INFO):
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_setup - VIOLATIONS DETECTED (DC violations: 5, Peak violations: 3, Total problem nets: 8) [WAIVED_AS_INFO]
```

---

## Type 3: Value Check with Waiver Logic

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-14:
  description: "Confirm the noise/glitch check result is clean."
  requirements:
    value: 2
    pattern_items:
      - "func_rcff_0p825v_125c_pcff_cmin_pcff3_hold"
      - "func_rcss_0p675v_125c_pcss_cmax_prcs3_hold"
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt"
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt"
  waivers:
    value: 1
    waive_items:
      - name: "func_rcss_0p675v_125c_pcss_cmax_prcs3_setup"
        reason: "Waived per design review - violations occur only in non-critical debug paths, approved by design team on 2024-01-15"
```

**Check Behavior:**
Type 3 = Type 2 + waiver support.
Same pattern search logic as Type 2, plus waiver classification:
- Match found_items against waive_items
- Unwaived items → ERROR (need fix)
- Waived items → INFO with [WAIVER] tag (approved)
- Unused waivers → WARN with [WAIVER] tag
PASS if all found_items (violations) are waived.

**Sample Output (with waived items):**
```
Status: PASS
Reason: All violations waived
INFO01 (Waived):
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_setup - VIOLATIONS DETECTED (DC violations: 5, Peak violations: 3, Total problem nets: 8) [WAIVER]
WARN01 (Unused Waivers):
  - View: func_rcff_0p825v_125c_pcff_cmin_pcss3_hold - violations: Waiver not matched - no corresponding violation found in noise reports
```

---

## Type 4: Boolean Check with Waiver Logic

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-14:
  description: "Confirm the noise/glitch check result is clean."
  requirements:
    value: N/A
    pattern_items: []
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_1.rpt"
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/noise_2.rpt"
  waivers:
    value: 1
    waive_items:
      - name: "func_rcss_0p675v_125c_pcss_cmax_prcs3_setup"
        reason: "Waived per design review - violations occur only in low-power test modes, approved by design team on 2024-01-15"
```

**Check Behavior:**
Type 4 = Type 1 + waiver support.
Same boolean check as Type 1 (no pattern_items), plus waiver classification:
- Match violations against waive_items
- Unwaived violations → ERROR
- Waived violations → INFO with [WAIVER] tag
- Unused waivers → WARN with [WAIVER] tag
PASS if all violations are waived.

**Sample Output:**
```
Status: PASS
Reason: All items waived
INFO01 (Waived):
  - View: func_rcss_0p675v_125c_pcss_cmax_prcs3_setup - VIOLATIONS DETECTED (DC violations: 5, Peak violations: 3, Total problem nets: 8) [WAIVER]
```

---

## Testing

### Test Commands

```powershell
# Create test snapshots for all types
python common/regression_testing/create_all_snapshots.py --modules 10.0_STA_DCD_CHECK --checkers IMP-10-0-0-14 --force

# Run individual tests
python IMP-10-0-0-14.py
```

---

## Notes

- **Multi-file aggregation**: The checker processes multiple noise report files (one per timing view/corner) and aggregates results. All views must be clean for the check to pass.
- **Primary metric**: "Number of total problem noise nets" is the primary pass/fail indicator. DC tolerance violations and receiver output peak violations are sub-categories.
- **Detailed violation parsing**: If violations are detected (total_problem_nets > 0), the checker can optionally parse the detailed violation table to extract net names, violation types (VH/VL), noise values, and affected pins for more granular reporting.
- **Threshold configuration**: The report includes a threshold configuration table showing VL/VH values for Clock/Data/Latch signals. This is informational and not used for pass/fail determination.
- **View naming**: View names encode PVT corner information (e.g., func_rcss_0p675v_125c = functional mode, slow-slow corner, 0.675V, 125°C). This helps identify which corners have violations.
- **Known limitations**: 
  - The checker assumes all input files follow the same Cadence Tempus/Innovus report format
  - Missing or corrupted files will cause the check to fail
  - The detailed violation table format may vary between tool versions