# IMP-10-0-0-17: Confirm the min-pulse check result is clean.

## Overview

**Check ID:** IMP-10-0-0-17  
**Description:** Confirm the min-pulse check result is clean.  
**Category:** Static Timing Analysis (STA) - Min Pulse Width Verification  
**Input Files:** `${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt`

This checker validates that all sequential clock pulse width checks pass across all timing views. It parses STA min pulse width violation reports to ensure no clock pulse width violations exist. Violations indicate that clock pulses are too narrow to meet library cell requirements, which can cause functional failures. The checker aggregates results across multiple timing corners/views and reports any violations with detailed context (pin name, slack, clock, view).

---

## Check Logic

### Input Parsing
The checker parses min pulse width violation reports generated by STA tools. Each report contains sequential clock pulse width check results organized by paths, with violation details including pin names, slack values, clock names, and timing views.

**Key Patterns:**
```python
# Pattern 1: Violation header - identifies violated paths with slack
pattern1 = r'Path\s+(\d+):\s+(VIOLATED|MET)\s+\(([+-]?\d+\.\d+)\s+ns\)\s+PulseWidth\s+Check\s+with\s+Pin\s+([\w/]+)'
# Example: "Path 1: VIOLATED (-0.849 ns) PulseWidth Check with Pin RAM_256x16/CLK-CLK"

# Pattern 2: View name extraction
pattern2 = r'View:\s+([\w_]+)'
# Example: "         View: func_slow_RCMAX"

# Pattern 3: Clock name extraction
pattern3 = r'Clock:\s+\([RF]\)\s+([\w_]+)'
# Example: "              Clock: (R) ram_clk"

# Pattern 4: Final slack value confirmation
pattern4 = r'Slack:=\s+([+-]?\d+\.\d+)'
# Example: "              Slack:=   -0.849"

# Pattern 5: Section header marker
pattern5 = r'SEQUENTIAL CLOCK PULSE WIDTH'
# Example: "SEQUENTIAL CLOCK PULSE WIDTH"
```

### Detection Logic
1. **File Discovery**: Locate all `*min_pulse_width_hold.rpt` files matching the glob pattern
2. **State Machine Parsing**: Process each file line-by-line with states:
   - `SEARCHING`: Looking for "Path N:" headers
   - `IN_VIOLATION`: Collecting violation details (view, clock, slack)
   - `COMPLETE_VIOLATION`: Violation fully parsed, ready for next
3. **Violation Extraction**: For each "VIOLATED" path, extract:
   - Pin name from path header
   - Slack value (negative = violation severity)
   - View name (timing corner)
   - Clock name
4. **Aggregation**: Sum violations across all files and views
5. **Pass/Fail Decision**:
   - **PASS**: violation_count == 0 (all paths MET)
   - **FAIL**: violation_count > 0 (at least one VIOLATED path)
6. **Edge Cases**:
   - Empty files → 0 violations, PASS
   - All paths MET → 0 violations, PASS
   - Missing view field → Use 'unknown_view', still report violation
   - Multiple files same view → Aggregate without double-counting

---

## Output Descriptions (CRITICAL - Code Generator Uses These!)

This section defines the output strings used by `build_complete_output()` in the checker code.
**Fill in these values based on the check logic above.**

```python
# Item description for this checker
item_desc = "Confirm the min-pulse check result is clean."

# PASS case - what message to show when check passes
found_reason = "All min pulse width checks passed across all timing views"
found_desc = "Min pulse width verification clean"

# FAIL case - what message to show when check fails
missing_reason = "Min pulse width violations detected"
missing_desc = "Min pulse width verification failed - clock pulses too narrow"

# WAIVED case (Type 3/4) - what message to show for waived items
waived_base_reason = "Min pulse width violation waived per design team approval"
waived_desc = "Waived min pulse width violations"

# UNUSED waivers - what message to show for unused waiver entries
unused_waiver_reason = "Waiver not matched - no corresponding pulse width violation found"
unused_desc = "Unused min pulse width waiver entries"
```

### INFO01/ERROR01 Display Format

```
INFO01 (Clean/Pass items):
  Format: "Checked {total_paths} pulse width paths across {views} view(s). Found 0 violations."
  Example: "Checked 156 pulse width paths across 8 view(s). Found 0 violations."

ERROR01 (Violation/Fail items):
  Format: "[{pin_name}] Pulse width violation: {slack}ns (clock: {clock_name}, view: {view_name})"
  Example: "[RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)"
```

---

## Type 1: Boolean Check

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-17:
  description: "Confirm the min-pulse check result is clean."
  requirements:
    value: N/A
    pattern_items: []
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt"
  waivers:
    value: N/A
    waive_items: []
```

**Check Behavior:**
Type 1 performs custom boolean checks (file exists? config valid?).
PASS/FAIL based on checker's own validation logic.

**Sample Output (PASS):**
```
Status: PASS
Reason: All min pulse width checks passed across all timing views
INFO01:
  - Checked 156 pulse width paths across 8 view(s). Found 0 violations.
```

**Sample Output (FAIL):**
```
Status: FAIL
Reason: Min pulse width violations detected
ERROR01:
  - [RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)
  - [FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN)
```

### Type 1 Variant: waivers.value=0 (Forced PASS Mode)

**Configuration:**
```yaml
IMP-10-0-0-17:
  description: "Confirm the min-pulse check result is clean."
  requirements:
    value: N/A
    pattern_items: []
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt"
  waivers:
    value: 0  # CRITICAL: value=0 triggers forced PASS mode (NOT waiver logic!)
    waive_items:  # IMPORTANT: Use PLAIN STRING format (NOT name/reason dict!)
      - "Explanation: Min pulse width violations are informational only for this IP block"
      - "Note: Violations are expected in fast corner due to conservative library characterization"
      - "Action: Design team confirmed violations do not impact functionality in target process"
```

**CRITICAL Behavior (waivers.value=0):**
- NOTE: Type 1 has NO waiver logic. waive=0 is forced PASS mode only
- IMPORTANT: waive_items uses PLAIN STRINGS (NOT name/reason dict like Type 3/4!)
- waive_items serves as COMMENT ONLY (no matching/filtering logic)
- waive_items content printed as INFO with [WAIVED_INFO] tag
- ALL violations force converted: FAIL→PASS, displayed as INFO with [WAIVED_AS_INFO] tag
- Check ALWAYS returns PASS (violations shown as INFO for tracking)
- Used when: Check is informational only, violations expected/acceptable

**Sample Output (PASS with violations):**
```
Status: PASS  # Always PASS when waivers.value=0
Reason: All violations waived as informational
INFO01 ([WAIVED_INFO] - waive_items as comment):
  - "Explanation: Min pulse width violations are informational only for this IP block"
  - "Note: Violations are expected in fast corner due to conservative library characterization"
  - "Action: Design team confirmed violations do not impact functionality in target process"
INFO02 ([WAIVED_AS_INFO] - violations converted to PASS, shown as INFO):
  - [RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX) [WAIVED_AS_INFO]
  - [FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN) [WAIVED_AS_INFO]
```

---

## Type 2: Value Check

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-17:
  description: "Confirm the min-pulse check result is clean."
  requirements:
    value: 2
    pattern_items:
      - "[RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)"
      - "[FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN)"
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt"
  waivers:
    value: N/A
    waive_items: []
```

**Check Behavior:**
Type 2 searches pattern_items in input files.
PASS/FAIL depends on check purpose:
- Violation Check: PASS if found_items empty (no violations)
- Requirement Check: PASS if missing_items empty (all requirements met)

**Sample Output (PASS):**
```
Status: PASS
Reason: All min pulse width checks passed across all timing views
INFO01:
  - Checked 156 pulse width paths across 8 view(s). Found 0 violations.
```

### Type 2 Variant: waivers.value=0 (Forced PASS Mode)

**Configuration:**
```yaml
IMP-10-0-0-17:
  description: "Confirm the min-pulse check result is clean."
  requirements:
    value: 2
    pattern_items:
      - "[RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)"
      - "[FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN)"
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt"
  waivers:
    value: 0  # CRITICAL: value=0 triggers forced PASS mode (NOT waiver logic!)
    waive_items:  # IMPORTANT: Use PLAIN STRING format (NOT name/reason dict!)
      - "Explanation: Pattern check is informational - violations tracked but not blocking"
      - "Note: RAM pulse width violations are known issue in slow corner, fixed in next tapeout"
```

**CRITICAL Behavior (waivers.value=0):**
- NOTE: Type 2 has NO waiver logic. waive=0 is forced PASS mode only
- IMPORTANT: waive_items uses PLAIN STRINGS (NOT name/reason dict like Type 3/4!)
- waive_items serves as COMMENT ONLY (no matching/filtering logic)
- waive_items content printed as INFO with [WAIVED_INFO] tag
- ALL errors/mismatches force converted: ERROR→PASS, displayed as INFO with [WAIVED_AS_INFO] tag
- Check ALWAYS returns PASS (errors shown as INFO for tracking)
- Used when: Pattern check is informational, mismatches expected

**Sample Output (PASS with mismatches):**
```
Status: PASS  # Always PASS when waivers.value=0
Reason: All mismatches waived as informational
INFO01 ([WAIVED_INFO] - waive_items as comment):
  - "Explanation: Pattern check is informational - violations tracked but not blocking"
  - "Note: RAM pulse width violations are known issue in slow corner, fixed in next tapeout"
INFO02 ([WAIVED_AS_INFO] - errors converted to PASS, shown as INFO):
  - [RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX) [WAIVED_AS_INFO]
  - [FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN) [WAIVED_AS_INFO]
```

---

## Type 3: Value Check with Waiver Logic

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-17:
  description: "Confirm the min-pulse check result is clean."
  requirements:
    value: 2
    pattern_items:
      - "[RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)"
      - "[FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN)"
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt"
  waivers:
    value: 2
    waive_items:
      - name: "[RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)"
        reason: "Waived per design review - RAM vendor confirmed safe operation with -0.849ns margin"
      - name: "[FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN)"
        reason: "Waived - clock gating cell meets spec, library model overly conservative"
```

**Check Behavior:**
Type 3 = Type 2 + waiver support.
Same pattern search logic as Type 2, plus waiver classification:
- Match found_items against waive_items
- Unwaived items → ERROR (need fix)
- Waived items → INFO with [WAIVER] tag (approved)
- Unused waivers → WARN with [WAIVER] tag
PASS if all found_items (violations) are waived.

**Sample Output (with waived items):**
```
Status: PASS
Reason: All violations waived
INFO01 (Waived):
  - [RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX) [WAIVER]
  - [FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN) [WAIVER]
WARN01 (Unused Waivers):
  - (none)
```

---

## Type 4: Boolean Check with Waiver Logic

**Configuration (copy to item_data.yaml for testing):**
```yaml
IMP-10-0-0-17:
  description: "Confirm the min-pulse check result is clean."
  requirements:
    value: N/A
    pattern_items: []
  input_files:
    - "${CHECKLIST_ROOT}/IP_project_folder/reports/10.0/*min_pulse_width_hold.rpt"
  waivers:
    value: 2
    waive_items:
      - name: "[RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX)"
        reason: "Waived per design review - RAM vendor confirmed safe operation with -0.849ns margin"
      - name: "[FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN)"
        reason: "Waived - clock gating cell meets spec, library model overly conservative"
```

**Check Behavior:**
Type 4 = Type 1 + waiver support.
Same boolean check as Type 1 (no pattern_items), plus waiver classification:
- Match violations against waive_items
- Unwaived violations → ERROR
- Waived violations → INFO with [WAIVER] tag
- Unused waivers → WARN with [WAIVER] tag
PASS if all violations are waived.

**Sample Output:**
```
Status: PASS
Reason: All items waived
INFO01 (Waived):
  - [RAM_256x16/CLK-CLK] Pulse width violation: -0.849ns (clock: ram_clk, view: func_slow_RCMAX) [WAIVER]
  - [FIFO_CTRL/clk_gate/CLK] Pulse width violation: -0.123ns (clock: sys_clk, view: func_fast_RCMIN) [WAIVER]
```

---

## Testing

### Test Commands

```powershell
# Create test snapshots for all types
python common/regression_testing/create_all_snapshots.py --modules 10.0_STA_DCD_CHECK --checkers IMP-10-0-0-17 --force

# Run individual tests
python IMP-10-0-0-17.py
```

---

## Notes

- **Multi-View Aggregation**: Checker aggregates violations across all timing views (corners). Each view may have different violations due to PVT variations.
- **Negative Slack = Violation**: Slack values are negative for violations. More negative = more severe violation.
- **Clock Edge Sensitivity**: Pattern extracts clock edge (R=rising, F=falling) but currently not used in violation reporting. Can be added if needed.
- **Path Numbering**: "Path N:" numbering is per-file and may not be unique across multiple reports. Use pin+view+clock as unique identifier.
- **Empty Report Handling**: Empty files or reports with no "SEQUENTIAL CLOCK PULSE WIDTH" section are treated as clean (0 violations).
- **Truncated Reports**: If report is incomplete (missing slack/view/clock fields), checker processes available data and may use 'unknown' placeholders.
- **Performance**: For large designs with 1000+ paths, parsing may take several seconds. Consider caching results if running repeatedly.