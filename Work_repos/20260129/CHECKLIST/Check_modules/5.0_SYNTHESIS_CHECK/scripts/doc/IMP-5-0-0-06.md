# IMP-5-0-0-06: Empty Modules Checker

## Overview

**Check ID:** IMP-5-0-0-06  
**Description:** Confirm Empty Modules are none or explained?  
**Category:** Synthesis Quality Check  
**Input Files:** Synthesis log files (`synthesis.log`)

This checker validates that synthesis does not generate empty modules by parsing the "Check Design Report" section from synthesis logs. Empty modules can indicate design quality issues and should be investigated or properly explained through waivers.

---

## Check Logic

### Input Parsing
The checker scans synthesis log files for the "Check Design Report" section and extracts information about empty modules:

1. **Locate Section**: Find "Check Design Report" header
2. **Navigate to Empty Modules**: Within the report, locate the "Empty Modules" subsection
3. **Extract Module Names**: Parse empty module names and their line numbers
4. **Store Metadata**: Cache module information for detailed reporting

### Pattern Matching
```
Check Design Report (c)
...
Unresolved References ... Empty Modules
...
design 'top_module' has the following empty module(s):
    empty_module_1
    empty_module_2
Total number of empty modules in design: 2
```

### Detection Logic
- **No Empty Modules**: "No empty modules in design" message found
- **Has Empty Modules**: Module names listed under "design has the following empty module(s)"
- **Module Extraction**: Single-word module names on individual lines
- **End of List**: Detected by "Total number of empty modules" line

---

## Type 1: Informational Check

**Configuration:**
```yaml
requirements:
  value: N/A
waivers:
  value: N/A  # or 0
```

**Check Behavior:**
- Always returns **PASS**
- Reports all empty modules as INFO items (if any found)
- No enforcement, purely informational

**Output Example (No Empty Modules):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
IMP-5-0-0-06-INFO01: Check result:
  Severity: Info Occurrence: 1
  - No empty modules found in synthesis logs
```

**Output Example (Empty Modules Found):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
IMP-5-0-0-06-INFO01: Check result:
  Severity: Info Occurrence: 2
  - module_a (Line: 1234 in /path/to/synthesis.log)
    Reason: Empty module found (informational only)
  - module_b (Line: 1235 in /path/to/synthesis.log)
    Reason: Empty module found (informational only)
```

**Use Case:**
- During early development when empty modules are expected
- Monitoring synthesis quality without enforcement
- Collecting data on empty module patterns

---

## Type 2: Value Check (No Waivers)

**Configuration:**
```yaml
requirements:
  value: 0
  pattern_items:
    - "0"
waivers:
  value: N/A  # or 0
```

**Check Behavior:**
- **PASS**: No empty modules found (count == 0)
- **FAIL**: Any empty modules detected (count > 0)
- No waiver support - all violations cause FAIL

**Output Example (PASS):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
Value: 0
IMP-5-0-0-06-INFO01: Check result:
  Severity: Info Occurrence: 1
  - No empty modules found in synthesis logs
```

**Output Example (FAIL):**
```
FAIL:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
Value: 2
IMP-5-0-0-06-ERROR01: Empty modules not explained:
  Severity: Fail Occurrence: 2
  - module_a (Line: 1234 in /path/to/synthesis.log)
    Reason: Empty module found
  - module_b (Line: 1235 in /path/to/synthesis.log)
    Reason: Empty module found
```

**Use Case:**
- Production flows requiring zero empty modules
- Strict quality gates before signoff
- Enforcing clean synthesis results

---

## Type 3: Value Check with Waivers

**Configuration:**
```yaml
requirements:
  value: 0
  pattern_items:
    - "0"
waivers:
  value: 2
  pattern_items:
    - "test_*"
    - "dummy_module"
  reason_items:
    - "Test infrastructure modules"
    - "Placeholder module for future implementation"
```

**Check Behavior:**
- **PASS**: All empty modules are waived OR no empty modules found
- **FAIL**: Unwaived empty modules exist
- Supports pattern matching with wildcards (`*`, `?`)
- Reports unused waiver patterns as WARN

**Output Example (All Waived - PASS):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
Value: 2
IMP-5-0-0-06-INFO01: Empty modules waived:
  Severity: Info Occurrence: 2
  - [WAIVER] test_wrapper (Line: 1234 in /path/to/synthesis.log)
    Reason: Test infrastructure modules
  - [WAIVER] dummy_module (Line: 1235 in /path/to/synthesis.log)
    Reason: Placeholder module for future implementation
```

**Output Example (Partial Waiver - FAIL):**
```
FAIL:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
Value: 3
IMP-5-0-0-06-ERROR01: Empty modules not explained:
  Severity: Fail Occurrence: 1
  - production_module (Line: 1236 in /path/to/synthesis.log)
    Reason: Empty module found (not waived)

IMP-5-0-0-06-INFO01: Empty modules waived:
  Severity: Info Occurrence: 2
  - [WAIVER] test_wrapper (Line: 1234 in /path/to/synthesis.log)
    Reason: Test infrastructure modules
  - [WAIVER] dummy_module (Line: 1235 in /path/to/synthesis.log)
    Reason: Placeholder module for future implementation
```

**Output Example (Unused Waiver - PASS with WARNING):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
Value: 1
IMP-5-0-0-06-INFO01: Empty modules waived:
  Severity: Info Occurrence: 1
  - [WAIVER] test_wrapper (Line: 1234 in /path/to/synthesis.log)
    Reason: Test infrastructure modules

IMP-5-0-0-06-WARN01: Unused waiver patterns:
  Severity: Warn Occurrence: 1
  - dummy_module
    Reason: Placeholder module for future implementation
```

**Pattern Matching Examples:**
```yaml
pattern_items:
  - "test_*"        # Matches: test_a, test_wrapper, test_123
  - "*_dummy"       # Matches: module_dummy, abc_dummy
  - "temp_?"        # Matches: temp_1, temp_a (single char)
  - "exact_name"    # Matches: exact_name only
```

**Use Case:**
- Allowing known empty modules with documentation
- Temporary placeholders during development
- Test infrastructure modules
- Incremental cleanup of legacy empty modules

---

## Type 4: Boolean Check with Waivers

**Configuration:**
```yaml
requirements:
  value: N/A
waivers:
  value: 1
  pattern_items:
    - "legacy_*"
  reason_items:
    - "Legacy module to be removed in next release"
```

**Check Behavior:**
- **PASS**: No empty modules OR all empty modules are waived
- **FAIL**: Any unwaived empty modules exist
- Boolean check (not counting specific values)
- Supports waiver patterns and reasons

**Output Example (No Empty Modules - PASS):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
IMP-5-0-0-06-INFO01: Check result:
  Severity: Info Occurrence: 1
  - No empty modules found in synthesis logs
```

**Output Example (All Waived - PASS):**
```
PASS:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
IMP-5-0-0-06-INFO01: Empty modules waived:
  Severity: Info Occurrence: 1
  - [WAIVER] legacy_wrapper (Line: 1234 in /path/to/synthesis.log)
    Reason: Legacy module to be removed in next release
```

**Output Example (Unwaived Module - FAIL):**
```
FAIL:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
IMP-5-0-0-06-ERROR01: Empty modules not explained:
  Severity: Fail Occurrence: 1
  - new_module (Line: 1236 in /path/to/synthesis.log)
    Reason: Empty module found (not waived)

IMP-5-0-0-06-INFO01: Empty modules waived:
  Severity: Info Occurrence: 1
  - [WAIVER] legacy_wrapper (Line: 1234 in /path/to/synthesis.log)
    Reason: Legacy module to be removed in next release
```

**Use Case:**
- Standard production flow with known exceptions
- Most common configuration for synthesis checks
- Allowing documented empty modules
- Gradual migration from legacy designs

---

## Configuration Errors

### Missing Input Files

**Scenario:** Synthesis log file not found

**Output:**
```
FAIL:IMP-5-0-0-06:Confirm Empty Modules are none or explained?
IMP-5-0-0-06-ERROR01: Configuration error - missing input files:
  Severity: Fail Occurrence: 1
  - /path/to/synthesis.log
    Reason: Input file does not exist
```

**Resolution:**
- Verify synthesis has been run
- Check file path configuration in DATA_INTERFACE.yaml
- Ensure synthesis log generation is enabled

### No Check Design Report

**Scenario:** Synthesis log exists but doesn't contain "Check Design Report" section

**Behavior:**
- Empty modules dict will be empty
- Checker will treat as "no empty modules found"
- Returns PASS (no violations detected)

**Note:** This is expected behavior for logs that don't generate Check Design Reports

---

## FAQ

### Q1: What causes empty modules in synthesis?

**A:** Empty modules typically occur when:
- Black box modules have no internal implementation
- Test infrastructure modules are intentionally left empty
- Modules are placeholders for future development
- Hierarchical design has stub modules
- IP blocks are not yet integrated

### Q2: How do I waive specific empty modules?

**A:** Use Type 3 or Type 4 with pattern matching:
```yaml
waivers:
  value: 2
  pattern_items:
    - "test_harness"      # Exact match
    - "stub_*"            # Wildcard pattern
  reason_items:
    - "Test infrastructure - intentionally empty"
    - "Placeholder modules for future implementation"
```

### Q3: What's the difference between Type 2 and Type 4?

**A:**
- **Type 2**: No waivers allowed, strictly enforces zero empty modules
- **Type 4**: Boolean check with waiver support, allows documented exceptions

Both FAIL if violations exist, but Type 4 allows waivers while Type 2 does not.

### Q4: How do pattern wildcards work?

**A:** Pattern matching supports standard wildcards:
- `*` - Matches any sequence of characters
- `?` - Matches exactly one character
- No wildcard - Exact string match required

Examples:
- `test_*` matches: test_a, test_wrapper, test_123
- `temp_?` matches: temp_1, temp_a (but not temp_12)
- `exact_name` matches: exact_name only

### Q5: What if I have multiple synthesis logs?

**A:** The checker processes all configured input files:
```yaml
input_files:
  - /path/to/synthesis_1.log
  - /path/to/synthesis_2.log
```

Empty modules from all logs are merged and checked together. If the same module appears in multiple logs, the first occurrence is reported.

### Q6: Why am I getting WARN01 for unused waiver patterns?

**A:** Unused waiver warnings indicate:
- Waiver pattern doesn't match any empty modules
- Module may have been fixed/removed
- Pattern may be too specific or have typos

This helps maintain clean waiver configurations and catch outdated waivers.

### Q7: Can I check for specific empty module counts?

**A:** Yes, use Type 2 or Type 3 with requirements:
```yaml
requirements:
  value: 0          # Expected count
  pattern_items:
    - "0"           # Stringified expected value
```

The checker compares actual count against expected value.

### Q8: How do I run this checker standalone?

**A:**
```bash
# Auto-detect type from configuration
python IMP-5-0-0-06.py

# Force specific type (1-4)
python IMP-5-0-0-06.py 1
python IMP-5-0-0-06.py 4
```

### Q9: What if Check Design Report is missing from the log?

**A:** If the log file exists but doesn't contain "Check Design Report":
- The checker treats this as "no empty modules found"
- Returns PASS (no violations)
- This is expected for logs from tools that don't generate this section

### Q10: How do I document why a module is waived?

**A:** Use `reason_items` in the same order as `pattern_items`:
```yaml
waivers:
  pattern_items:
    - "test_wrapper"
    - "stub_*"
  reason_items:
    - "Test infrastructure - intentionally empty"
    - "Placeholder modules awaiting implementation"
```

Each reason is matched to its corresponding pattern by position.

---

## Best Practices

### 1. Choose the Right Type

| Scenario | Recommended Type | Rationale |
|----------|-----------------|-----------|
| Production signoff | Type 2 | No exceptions, strict enforcement |
| Standard flow with known exceptions | Type 4 | Boolean check with waivers |
| Complex validation | Type 3 | Value tracking with waiver support |
| Development/debugging | Type 1 | Informational only, no blocking |

### 2. Waiver Management

**DO:**
- ✅ Document each waiver with clear reasons
- ✅ Use specific module names when possible
- ✅ Review and clean up unused waivers regularly
- ✅ Include ticket/issue numbers in waiver reasons
- ✅ Use patterns for systematic exceptions (e.g., `test_*`)

**DON'T:**
- ❌ Use overly broad patterns like `*` or `module_*`
- ❌ Leave waivers without reasons
- ❌ Keep outdated waivers indefinitely
- ❌ Waive modules without investigation

### 3. Pattern Design

```yaml
# Good: Specific and meaningful
pattern_items:
  - "test_harness"
  - "bist_stub_*"
  - "legacy_wrapper_v1"

# Bad: Too broad
pattern_items:
  - "*"              # Matches everything
  - "module_*"       # Too generic
```

### 4. Reason Documentation

```yaml
# Good: Clear and actionable
reason_items:
  - "Test infrastructure - intentionally empty (JIRA-1234)"
  - "BIST stubs awaiting RTL from IP vendor (ETA: Q2 2025)"
  - "Legacy module deprecated - removal planned for v2.0"

# Bad: Vague or missing
reason_items:
  - "temporary"
  - "known issue"
  - ""
```

### 5. Input File Configuration

```yaml
# Ensure synthesis log includes Check Design Report
# Configure in synthesis script:
check_design -all

# In DATA_INTERFACE.yaml:
input_files:
  - "${PROJECT_ROOT}/logs/synthesis.log"
```

### 6. Integration with CI/CD

```bash
# In your synthesis flow:
genus -f synthesis.tcl
check_design -all > synthesis.log

# Run checker after synthesis
python IMP-5-0-0-06.py

# Check exit code
if [ $? -ne 0 ]; then
    echo "Empty modules check failed"
    exit 1
fi
```

### 7. Handling Legacy Designs

When migrating legacy designs with many empty modules:

1. **Phase 1**: Use Type 1 to collect data
2. **Phase 2**: Switch to Type 4, waive all current empty modules
3. **Phase 3**: Gradually reduce waivers as modules are fixed
4. **Phase 4**: Remove waivers and enforce Type 2 for new modules

```yaml
# Phase 2 example
waivers:
  value: 10
  pattern_items:
    - "legacy_*"
    - "stub_*"
    - "old_wrapper"
  reason_items:
    - "Legacy modules - cleanup tracked in JIRA-5678"
    - "Stubs from v1.0 - removal planned for v2.0"
    - "Deprecated wrapper - new version in development"
```

### 8. Monitoring and Reporting

- Track waiver count over time - should trend downward
- Review WARN01 (unused waivers) regularly
- Investigate new empty modules immediately
- Include empty module metrics in quality reports

### 9. Root Cause Analysis

Before waiving an empty module, investigate:
1. Why is the module empty?
2. Is this expected behavior?
3. Can the module be removed entirely?
4. Is there missing RTL that should be added?
5. Is this a tool/synthesis issue?

### 10. Cross-Check with Other Tools

Empty modules might indicate:
- Missing source files (check file lists)
- Synthesis elaboration issues (check synthesis logs)
- Black box definitions (check constraints)
- IP integration problems (check vendor deliverables)

---

## Related Checkers

- **IMP-5-0-0-05**: Unresolved References - Often related to empty modules
- **IMP-5-0-0-10**: QoR Report - Overall synthesis quality metrics
- **IMP-7-0-0-XX**: Design-In Checks - Pre-implementation validation

---

## Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-11-26 | Refactoring | Migrated to BaseChecker, added 4-type support |
| 0.9 | 2025-11-04 | yyin | Migrated to BooleanCheckerWithWaiverBase (Type 4) |
| 0.8 | 2025-10-24 | yyin | Initial implementation |

---

**Last Updated:** 2025-11-26  
**Checker Version:** 1.0 (BaseChecker with 4-type support)
