# IMP-5-0-0-07: SDC Violations Checker

## Overview

**Check ID:** IMP-5-0-0-07  
**Description:** Confirm that there are no other violations or errors (max cap, max transition etc)?  
**Category:** Synthesis Constraints Check  
**Input Files:** Synthesis log files (`synthesis.log`, prefer `*_generic.log`)

This checker validates that synthesis does not encounter SDC constraint violations by parsing the `read_sdc` command results in synthesis logs. SDC violations can indicate constraint definition issues, object naming problems, or timing specification errors that should be resolved before proceeding to implementation.

---

## Check Logic

### Input Parsing
The checker scans synthesis log files for `read_sdc` command sections and extracts violation information:

1. **Locate Sections**: Find all "# Reading SDC" to "read_sdc completed" blocks
2. **Check Statistics**: Parse command statistics to identify failed commands
3. **Extract Details**: Collect error type, line number, SDC file path, and command text
4. **Priority Assignment**: Group errors by type with predefined priority numbering

### Log Section Pattern
```
# Reading SDC file '/path/to/constraints.sdc'
...
"set_false_path"  - successful 10 , failed 2 (runtime 0.00)
"get_clocks"      - successful 5 , failed 1 (runtime 0.00)
...
Total failed commands during read_sdc are 3
```

### Error Detail Pattern
```
Error : Object 'CLK_A' not found. [get_clocks]
  on line '181' of the SDC file '/path/to/constraints.sdc'
  set_false_path -from [get_clocks CLK_A] -to [get_clocks CLK_B]
```

### Error Prioritization
Errors are numbered (ERROR01-ERROR22+) based on command type priority:
- ERROR01: `all_clocks`
- ERROR07: `get_clocks`
- ERROR16: `set_false_path`
- ERROR18: `set_input_delay`
- etc. (see `ERROR_PRIORITY` list)

---

## Type 1: Informational Check

**Configuration:**
```yaml
requirements:
  value: N/A
waivers:
  value: N/A  # or 0
```

**Check Behavior:**
- Always returns **PASS**
- Reports all SDC violations as INFO items (if any found)
- No enforcement, purely informational
- Useful for debugging constraint issues

**Output Example (No Violations):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
IMP-5-0-0-07-INFO01: Check result:
  Severity: Info Occurrence: 1
  - No SDC violations found in synthesis logs
```

**Output Example (Violations Found):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
IMP-5-0-0-07-INFO01: Check result:
  Severity: Info Occurrence: 2
  - set_false_path -from [get_clocks CLK_A] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Object 'CLK_A' not found (informational only)
  - set_input_delay -clock CLK_C 2.0 [get_ports DIN] (Line: 203 in /path/to/constraints.sdc)
    Reason: get_clocks: Object 'CLK_C' not found (informational only)
```

**Use Case:**
- During constraint development
- Debugging SDC issues without blocking synthesis
- Understanding constraint coverage gaps

---

## Type 2: Value Check (No Waivers)

**Configuration:**
```yaml
requirements:
  value: 0
  pattern_items:
    - "0"
waivers:
  value: N/A  # or 0
```

**Check Behavior:**
- **PASS**: No SDC violations found (count == 0)
- **FAIL**: Any SDC violations detected (count > 0)
- No waiver support - all violations cause FAIL
- Strict enforcement for production flows

**Output Example (PASS):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
Value: 0
IMP-5-0-0-07-INFO01: Check result:
  Severity: Info Occurrence: 1
  - No SDC violations found in synthesis logs
```

**Output Example (FAIL - Multiple Error Types):**
```
FAIL:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
Value: 3
IMP-5-0-0-07-ERROR07: get_clocks:
  Severity: Fail Occurrence: 2
  - set_false_path -from [get_clocks CLK_A] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Object 'CLK_A' not found
  - set_input_delay -clock CLK_C 2.0 [get_ports DIN] (Line: 203 in /path/to/constraints.sdc)
    Reason: get_clocks: Object 'CLK_C' not found

IMP-5-0-0-07-ERROR16: set_false_path:
  Severity: Fail Occurrence: 1
  - set_false_path -from INVALID_PORT -to [get_clocks CLK_B] (Line: 195 in /path/to/constraints.sdc)
    Reason: set_false_path: Invalid object specification
```

**Use Case:**
- Production signoff requiring clean SDC application
- CI/CD gates enforcing constraint quality
- Final validation before tapeout

---

## Type 3: Value Check with Waivers

**Configuration:**
```yaml
requirements:
  value: 0
  pattern_items:
    - "0"
waivers:
  value: 2
  pattern_items:
    - "set_false_path -from *CLK_TEST*"
    - "set_input_delay -clock CLK_SCAN*"
  reason_items:
    - "Test clock paths - not used in functional mode"
    - "Scan clocks - timing not critical"
```

**Check Behavior:**
- **PASS**: All SDC violations are waived OR no violations found
- **FAIL**: Unwaived SDC violations exist
- Supports pattern matching on violation commands
- Reports unused waiver patterns as WARN

**Output Example (All Waived - PASS):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
Value: 2
IMP-5-0-0-07-INFO01: SDC violations waived:
  Severity: Info Occurrence: 2
  - [WAIVER] set_false_path -from [get_clocks CLK_TEST1] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Test clock paths - not used in functional mode
  - [WAIVER] set_input_delay -clock CLK_SCAN_A 2.0 [get_ports DIN] (Line: 203 in /path/to/constraints.sdc)
    Reason: get_clocks: Scan clocks - timing not critical
```

**Output Example (Partial Waiver - FAIL):**
```
FAIL:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
Value: 3
IMP-5-0-0-07-ERROR07: get_clocks:
  Severity: Fail Occurrence: 1
  - set_false_path -from [get_clocks CLK_FUNC] -to [get_clocks CLK_B] (Line: 195 in /path/to/constraints.sdc)
    Reason: get_clocks: Object 'CLK_FUNC' not found (not waived)

IMP-5-0-0-07-INFO01: SDC violations waived:
  Severity: Info Occurrence: 2
  - [WAIVER] set_false_path -from [get_clocks CLK_TEST1] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Test clock paths - not used in functional mode
  - [WAIVER] set_input_delay -clock CLK_SCAN_A 2.0 [get_ports DIN] (Line: 203 in /path/to/constraints.sdc)
    Reason: get_clocks: Scan clocks - timing not critical
```

**Output Example (Unused Waiver - PASS with WARNING):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
Value: 1
IMP-5-0-0-07-INFO01: SDC violations waived:
  Severity: Info Occurrence: 1
  - [WAIVER] set_false_path -from [get_clocks CLK_TEST1] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Test clock paths - not used in functional mode

IMP-5-0-0-07-WARN01: Unused waiver patterns:
  Severity: Warn Occurrence: 1
  - set_input_delay -clock CLK_SCAN*
    Reason: Scan clocks - timing not critical
```

**Pattern Matching Examples:**
```yaml
pattern_items:
  - "set_false_path -from*CLK_TEST*"       # Matches any test clock false paths
  - "*CLK_SCAN*"                           # Matches any command with CLK_SCAN
  - "set_input_delay -clock BIST_CLK*"     # Matches specific command patterns
```

**Use Case:**
- Allowing known constraint issues with documentation
- Test/debug infrastructure violations
- Incremental constraint cleanup
- Managing legacy constraint files

---

## Type 4: Boolean Check with Waivers

**Configuration:**
```yaml
requirements:
  value: N/A
waivers:
  value: 1
  pattern_items:
    - "*CLK_DEBUG*"
  reason_items:
    - "Debug clocks - not synthesized in production mode"
```

**Check Behavior:**
- **PASS**: No SDC violations OR all violations are waived
- **FAIL**: Any unwaived SDC violations exist
- Boolean check (not counting specific values)
- Most common configuration for synthesis checks

**Output Example (No Violations - PASS):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
IMP-5-0-0-07-INFO01: Check result:
  Severity: Info Occurrence: 1
  - No SDC violations found in synthesis logs
```

**Output Example (All Waived - PASS):**
```
PASS:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
IMP-5-0-0-07-INFO01: SDC violations waived:
  Severity: Info Occurrence: 1
  - [WAIVER] set_false_path -from [get_clocks CLK_DEBUG] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Debug clocks - not synthesized in production mode
```

**Output Example (Unwaived Violation - FAIL):**
```
FAIL:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
IMP-5-0-0-07-ERROR07: get_clocks:
  Severity: Fail Occurrence: 1
  - set_false_path -from [get_clocks CLK_MAIN] -to [get_clocks CLK_B] (Line: 195 in /path/to/constraints.sdc)
    Reason: get_clocks: Object 'CLK_MAIN' not found (not waived)

IMP-5-0-0-07-INFO01: SDC violations waived:
  Severity: Info Occurrence: 1
  - [WAIVER] set_false_path -from [get_clocks CLK_DEBUG] -to [get_clocks CLK_B] (Line: 181 in /path/to/constraints.sdc)
    Reason: get_clocks: Debug clocks - not synthesized in production mode
```

**Use Case:**
- Standard production flow with documented exceptions
- Most common configuration
- Allowing specific constraint issues while catching new ones
- Gradual constraint quality improvement

---

## Configuration Errors

### Missing Input Files

**Scenario:** Synthesis log file not found

**Output:**
```
FAIL:IMP-5-0-0-07:Confirm that there are no other violations or errors (max cap, max transition etc)?
IMP-5-0-0-07-ERROR01: Configuration error - missing input files:
  Severity: Fail Occurrence: 1
  - /path/to/synthesis.log
    Reason: Input file does not exist
```

**Resolution:**
- Verify synthesis has been run
- Check file path configuration in DATA_INTERFACE.yaml
- Ensure synthesis log generation is enabled

### No read_sdc Sections

**Scenario:** Synthesis log exists but doesn't contain "# Reading SDC" sections

**Behavior:**
- Checker returns configuration error
- Treats as missing/invalid input file
- Returns FAIL with appropriate error message

**Possible Causes:**
- SDC files not read during synthesis
- Wrong log file selected
- Synthesis flow doesn't use read_sdc command

---

## FAQ

### Q1: What causes SDC violations during synthesis?

**A:** Common causes include:
- **Missing objects**: Clocks, ports, or cells not yet created when SDC is read
- **Name mismatches**: Object names in SDC don't match actual design names
- **Hierarchy issues**: Incorrect hierarchical path specifications
- **Timing mode**: Constraints for modes not active during synthesis
- **Tool differences**: SDC syntax differences between tools

### Q2: How do I waive specific SDC violations?

**A:** Use Type 3 or Type 4 with pattern matching on the full command:
```yaml
waivers:
  value: 1
  pattern_items:
    - "set_false_path -from*CLK_TEST*"     # Wildcards in command
    - "*Object 'CLK_DEBUG' not found*"     # Match by error message
  reason_items:
    - "Test clock - not used in production"
    - "Debug clock - conditionally compiled out"
```

### Q3: What's the difference between error types (ERROR01-ERROR22)?

**A:** Error numbers correspond to SDC command types:
- **ERROR07** (`get_clocks`): Clock object lookup failures
- **ERROR16** (`set_false_path`): False path constraint errors
- **ERROR18** (`set_input_delay`): Input delay specification issues
- etc.

Priority is predefined based on typical SDC command usage order.

### Q4: Why does the checker prefer "generic" log files?

**A:** Generic synthesis logs typically contain:
- Complete SDC reading results
- All constraint application messages
- Comprehensive error reporting

Corner-specific logs may have filtered or abbreviated information.

### Q5: How do pattern wildcards work for SDC violations?

**A:** Patterns match against the full violation command:
- `*` matches any sequence of characters
- `?` matches exactly one character
- Matching is case-sensitive by default

Examples:
```yaml
pattern_items:
  - "*CLK_TEST*"                    # Matches any command with CLK_TEST
  - "set_false_path*"               # Matches all set_false_path commands
  - "*[get_clocks CLK_?]*"          # Matches single-char clock names
```

### Q6: What if I have multiple SDC files with violations?

**A:** The checker processes all read_sdc sections in the log:
```
# Reading SDC file 'constraints_1.sdc'
  ... violations tracked ...
# Reading SDC file 'constraints_2.sdc'
  ... violations tracked ...
```

All violations are merged and reported together. File path is preserved in error details.

### Q7: Can I check for specific violation counts?

**A:** Yes, use Type 2 or Type 3:
```yaml
requirements:
  value: 0          # Expected count (usually 0 for no violations)
  pattern_items:
    - "0"
```

The checker compares actual violation count against expected value.

### Q8: How do I run this checker standalone?

**A:**
```bash
# Auto-detect type from configuration
python IMP-5-0-0-07.py

# Force specific type (1-4)
python IMP-5-0-0-07.py 1
python IMP-5-0-0-07.py 4
```

### Q9: Why am I getting WARN01 for unused waiver patterns?

**A:** Unused waiver warnings indicate:
- Waiver pattern doesn't match any violations
- Violation may have been fixed
- Pattern may be too specific or have typos
- Different log file being analyzed

Review and remove outdated waivers to keep configuration clean.

### Q10: How do I document why a violation is waived?

**A:** Use `reason_items` in the same order as `pattern_items`:
```yaml
waivers:
  pattern_items:
    - "set_false_path -from*CLK_TEST*"
    - "*CLK_BIST*"
  reason_items:
    - "Test mode clocks - not active in functional operation (JIRA-1234)"
    - "BIST clocks - timing relaxed per spec section 4.2.3"
```

Each reason is matched to its corresponding pattern by position.

---

## Best Practices

### 1. Choose the Right Type

| Scenario | Recommended Type | Rationale |
|----------|-----------------|-----------|
| Production signoff | Type 2 | No exceptions, enforce clean SDC |
| Standard flow with exceptions | Type 4 | Boolean check with documented waivers |
| Complex tracking | Type 3 | Value comparison with waiver support |
| Constraint development | Type 1 | Informational only, no blocking |

### 2. Waiver Management

**DO:**
- ✅ Document each waiver with clear technical reasons
- ✅ Include reference to requirements/specs in waiver reasons
- ✅ Use specific patterns when possible to avoid over-waiving
- ✅ Review and clean up unused waivers regularly
- ✅ Track waiver trends - should decrease over time

**DON'T:**
- ❌ Use overly broad patterns like `*` or `set_*`
- ❌ Leave waivers without detailed technical justification
- ❌ Keep outdated waivers indefinitely
- ❌ Waive violations without root cause analysis

### 3. Pattern Design

```yaml
# Good: Specific and targeted
pattern_items:
  - "set_false_path -from [get_clocks CLK_TEST1]*"
  - "*Object 'BIST_CLK' not found*"
  - "set_input_delay -clock SCAN_CLK*"

# Bad: Too broad
pattern_items:
  - "*"                      # Matches everything
  - "set_*"                  # Too generic
  - "*not found*"            # Catches unrelated errors
```

### 4. Reason Documentation

```yaml
# Good: Complete and actionable
reason_items:
  - "Test clock CLK_TEST1 - only active in test mode, not synthesized (JIRA-5678)"
  - "BIST clock not present in functional synthesis - per DFT spec section 3.4"
  - "Scan clocks gated off in functional mode - no timing requirement (Design Doc v2.1)"

# Bad: Vague or incomplete
reason_items:
  - "test mode"
  - "known issue"
  - "to be fixed later"
```

### 5. Root Cause Analysis

Before waiving SDC violations, investigate:

1. **Why did the violation occur?**
   - Missing object definition?
   - Name mismatch?
   - Hierarchy error?
   - Mode-specific constraint?

2. **Is this expected behavior?**
   - Test/debug infrastructure?
   - Conditional clock domain?
   - Tool limitation?

3. **Can it be fixed instead of waived?**
   - Update SDC syntax?
   - Fix object names?
   - Reorder constraint files?

4. **What's the impact?**
   - Timing coverage gaps?
   - False paths not applied?
   - Missing constraints?

### 6. Integration with Constraint Flow

```tcl
# In synthesis script:
# 1. Source all SDC files
read_sdc constraints/functional.sdc
read_sdc constraints/test.sdc
read_sdc constraints/exceptions.sdc

# 2. Check for violations
check_timing -verbose

# 3. Run checker after synthesis
# python IMP-5-0-0-07.py
```

### 7. Handling Test/Debug Constraints

When dealing with test mode constraints:

```yaml
# Approach 1: Waive test-specific violations
waivers:
  pattern_items:
    - "*CLK_TEST*"
    - "*CLK_SCAN*"
    - "*BIST*"
  reason_items:
    - "Test clocks - not active in functional mode"
    - "Scan clocks - DFT infrastructure only"
    - "BIST clocks - memory test mode only"

# Approach 2: Separate SDC files by mode
# Only source functional SDC during functional synthesis
# read_sdc constraints/functional.sdc
# (Don't source test.sdc during functional synthesis)
```

### 8. Error Prioritization Strategy

Errors are auto-numbered by command type priority:
- **ERROR01-ERROR05**: Clock-related (`all_clocks`, `create_clock`, `get_clocks`)
- **ERROR06-ERROR15**: Object query (`get_cells`, `get_pins`, `get_ports`)
- **ERROR16-ERROR22**: Constraint commands (`set_false_path`, `set_input_delay`)

Focus on fixing lower-numbered errors first, as they're typically more fundamental.

### 9. Monitoring and Reporting

- **Track violation trends** over project timeline
- **Review waivers quarterly** - remove obsolete ones
- **Compare across corners** - violations should be consistent
- **Include in QoR reports** - constraint quality metric

### 10. Cross-Check with Other Tools

SDC violations often correlate with:
- **Missing clocks** in synthesis reports
- **Unconstrained paths** in timing analysis
- **Zero-slack paths** at unrealistic delays
- **DRC violations** in implementation

Coordinate SDC checker results with other quality checks.

---

## Error Code Reference

### Priority-Based Error Codes

| Code | Command Type | Typical Issue |
|------|-------------|---------------|
| ERROR01 | `all_clocks` | Clock query in wrong context |
| ERROR04 | `create_clock` | Clock definition failure |
| ERROR07 | `get_clocks` | Clock object not found |
| ERROR08 | `get_object_name` | Object naming issue |
| ERROR09 | `get_pins` | Pin not found |
| ERROR11 | `get_ports` | Port not found |
| ERROR16 | `set_false_path` | False path specification error |
| ERROR18 | `set_input_delay` | Input delay constraint issue |
| ERROR22 | `set_output_delay` | Output delay constraint issue |

### Custom Error Codes (ERROR23+)

For command types not in the predefined priority list, error codes are assigned dynamically starting from ERROR23.

---

## Related Checkers

- **IMP-5-0-0-05**: Unresolved References - May indicate missing clock/object definitions
- **IMP-5-0-0-06**: Empty Modules - Can cause object lookup failures
- **IMP-4-0-0-XX**: Constraint Checks - Pre-synthesis SDC validation

---

## Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-11-26 | Refactoring | Migrated to BaseChecker, added 4-type support |
| 0.9 | 2025-11-03 | yyin | Refactored to use BooleanChecker |
| 0.8 | 2025-11-03 | yyin | Initial implementation |

---

**Last Updated:** 2025-11-26  
**Checker Version:** 1.0 (BaseChecker with 4-type support)
